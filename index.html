<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上滑加载示例</title>
    <style>
        .content {
            height: 200px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="content-container"></div>
    <div id="loading" style="display: none;">加载中...</div>

    <script>
        let allDataLoaded = false;
        let isLoading = false;
        let itemCount = 0;
        const contentContainer = document.getElementById('content-container');
        const loading = document.getElementById('loading');

        function loadMoreContent() {
            if (allDataLoaded || isLoading) return;
            isLoading = true;
            loading.style.display = 'block';

            const oldScrollHeight = contentContainer.scrollHeight;

            // 模拟异步加载数据
            setTimeout(() => {
                // 创建文档片段提高性能
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < 5; i++) {
                    itemCount++;
                    const newContent = document.createElement('div');
                    newContent.className = 'content';
                    newContent.textContent = `第${itemCount}层`;
                    fragment.prepend(newContent);
                }
                contentContainer.prepend(fragment);

                loading.style.display = 'none';
                isLoading = false;

                // 保持滚动位置稳定
                const newScrollHeight = contentContainer.scrollHeight;
                window.scrollTo(0, newScrollHeight - oldScrollHeight);
            }, 1000);
        }

        function handleScroll() {
            // 检测滚动到顶部（距离顶部小于50px时触发）
            if (window.scrollY <= 50) {
                loadMoreContent();
            }
        }

        window.addEventListener('scroll', handleScroll);
        loadMoreContent(); // 初始加载
    </script>
</body>
</html>